---
layout:     post
title:      使用IntelliJ + SonarQube高效代码走查
date:       2015-04-29 19:53
#summary:    See what the different elements looks like. Your markdown has never looked better. I promise.
categories: tech
---
# 为什么要代码走查
敏捷内建质量的要求，代码是债务，代码走查可以减少技术债(technical debt)，保持cost of changes

# 代码走查常见痛点
* 时间长
 + 需要走查代码多
 + 讨论业务细节
 + 缺乏权威意见，容易争论，无法达成一致
* 成本高
 + 团队全体成员参加，成本高
* 效果不明显
 + 代码走查想做的事太多：知识传递、提升技能、业务交流、消除模块壁垒，结果很可能什么目的都没有达到

# 怎样才能高效代码走查

## 高效走查的前提

要做到高效代码走查需要具备两个前提条件：

* 精益需求管理（少做多得）
* 结对编程

代码走查是有成本的。如果每天花费精力走查一些原本可以更简洁的代码，或者走查一些最后被证明并不是用户想要的代码，会造成极大的浪费。因此，需要精益需求管理来保证代码走查用在对的地方，需要结对编程来保证每天走查的代码尽可能的少，并有一定的质量（由于结对编程，产生的代码量会减半、同时质量也会提高）。

每个人都应该思考一下：这个特性能否不写代码实现？如果需要写代码，能否少写代码，使用第三方库，复用已有的代码？最后，如果无法避免要写代码，能否尽力写出最好的代码？

至于“好”的标准，需要在代码走查中达成共识。

## 走查时机的选择

代码走查的时机一般有两种：

* 每日代码走查：每天都对前一天产生的新增代码进行走查。
* 功能/故事完成后的代码走查：当一个功能/故事完成后，对这些代码进行走查。

第二种方式的有两个主要缺点：

* 走查代码的范围比较难确定：敏捷开发中，功能/故事一般会持续3-5天，等到完成后哪些代码属于这个功能/故事已经不易确定。
* 走查出的问题，易被抵触：一旦功能/故事开发完成，再对代码提出修改意见，可能会受到较大抵触。

相比第二种走查方式的缺点，每日代码走查能够更好的圈定走查范围，并且在功能/故事开发中提出建议，团队成员也更乐于接受。

## 确定走查级别

框定范围：cleancode, tech debt


## 确定走查流程：
走查的时机确定了，级别确定了，那走查的范围就确定了。下面看走查的流程如何进行。
http://www.sonarqube.org/effective-code-review-with-sonar/

## 常见的走查效率提升工具
intellij diff:

intellij sonarqube plugin

manual code review:
http://www.sonarqube.org/sonar-2-8-in-screenshots/

action plan:

auto-assign:

scm stats: